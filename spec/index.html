<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta name="author" content="o2r project">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Specification - ERC spec</title>

    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">


    <link href="../erc.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">ERC spec</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">ERC <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li class="active">
    <a href="./">Specification</a>
</li>

                        
                            
<li >
    <a href="bundle_bagit/">BagIt Extension</a>
</li>

                        
                            
<li >
    <a href="r/">R Extension</a>
</li>

                        
                            
<li >
    <a href="man/">Manipulation Extension</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../user-guide/">User guide</a>
                    </li>
                
                
                
                    <li >
                        <a href="../dev-guide/">Developer guide</a>
                    </li>
                
                
                
                    <li >
                        <a href="../glossary/">Glossary</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="bundle_bagit/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#erc-specification">ERC specification</a></li>
        
            <li class="second-level"><a href="#version">Version</a></li>
            
        
            <li class="second-level"><a href="#table-of-contents">Table of contents</a></li>
            
        
            <li class="second-level"><a href="#notational-conventions">Notational conventions</a></li>
            
        
            <li class="second-level"><a href="#purpose">Purpose</a></li>
            
        
            <li class="second-level"><a href="#fundamental-design-concepts">Fundamental design concepts</a></li>
            
        
            <li class="second-level"><a href="#how-to-use-an-erc">How to use an ERC</a></li>
            
        
            <li class="second-level"><a href="#erc-structure">ERC structure</a></li>
            
                <li class="third-level"><a href="#base-directory">Base directory</a></li>
            
        
            <li class="second-level"><a href="#erc-configuration-file">ERC configuration file</a></li>
            
                <li class="third-level"><a href="#name-format-and-encoding">Name, format, and encoding</a></li>
            
                <li class="third-level"><a href="#required-fields">Required fields</a></li>
            
                <li class="third-level"><a href="#control-statements">Control statements</a></li>
            
                <li class="third-level"><a href="#discovery-metadata">Discovery metadata</a></li>
            
                <li class="third-level"><a href="#license-metadata">License metadata</a></li>
            
                <li class="third-level"><a href="#software-metadata">Software metadata</a></li>
            
                <li class="third-level"><a href="#extension-metadata">Extension metadata</a></li>
            
        
            <li class="second-level"><a href="#runtime-container-file">Runtime container file</a></li>
            
        
            <li class="second-level"><a href="#runtime-container-manifest">Runtime container manifest</a></li>
            
                <li class="third-level"><a href="#metadata-in-container-manifest-under-development">Metadata in container manifest - Under development</a></li>
            
        
            <li class="second-level"><a href="#ercignore-file">.ercignore file</a></li>
            
        
            <li class="second-level"><a href="#validation">Validation</a></li>
            
        
            <li class="second-level"><a href="#security-considerations">Security considerations</a></li>
            
        
            <li class="second-level"><a href="#secondary-metadata-files">Secondary metadata files</a></li>
            
        
            <li class="second-level"><a href="#comprehensive-example-of-ercyml">Comprehensive example of erc.yml</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="erc-specification">ERC specification</h1>
<p>An Exectuable Research Compendium (ERC) is a packaging convention for computational research.
It provides well-defined structure for data, code, documentation, and control of a piece of research and is suitable for long-term archival. As such it can also be perceived as an object or more specifically: a digital asset.</p>
<div class="alert note" markdown="block">
This is a draft specification. If you have comments or suggestions please file them in the <a href="https://github.com/o2r-project/erc-spec/issues">issue tracker</a>. If you have explicit changes please fork the <a href="https://github.com/o2r-project/erc-spec">git repo</a> and submit a pull request.
</div>

<h2 id="version">Version</h2>
<p>This version of this specification is <code>1</code>.</p>
<h2 id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="./">Introduction</a></li>
<li><a href="#notational-conventions">Notational conventions</a></li>
<li><a href="#purpose">Purpose</a></li>
<li><a href="#fundamental-concepts">Fundamental concepts</a></li>
<li><a href="#erc-structure">Structure</a></li>
<li><a href="#security">Security</a></li>
<li>Extensions</li>
<li><a href="bundle_bagit/">BagIt bundling extension</a></li>
<li><a href="r/">R extension</a></li>
<li><a href="valid.md">Validation extension</a></li>
<li>Extensions - <em>Under Development</em></li>
<li><a href="man/">Manipulation extension</a></li>
<li><a href="progress.md">Progress extension</a></li>
<li><a href="bundle_container.md">Container bundling extension</a></li>
<li><a href="glossary.md">Glossary</a></li>
</ul>
<h2 id="notational-conventions">Notational conventions</h2>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" are to be interpreted as described in <a href="http://tools.ietf.org/html/rfc2119">RFC 2119</a>.</p>
<p>The key words "unspecified", "undefined", and "implementation-defined" are to be interpreted as described in the <a href="http://www.open-std.org/jtc1/sc22/wg14/www/C99RationaleV5.10.pdf#page=18">rationale for the C99 standard</a>.</p>
<h2 id="purpose">Purpose</h2>
<p>This specification defines a structure to carry and execute packaged scientific analyses.
These typically consist of data, code and libraries in executable form which are needed to re-do an analysis, and the outputs of the original  analysis.
This allows to collect  computational  research  in  a self-contained fashion and support transfer, archival, reproduction, and validation.</p>
<h2 id="fundamental-design-concepts">Fundamental design concepts</h2>
<p>The bagtainer specification is inspired by two approaches to improve development and operation of software.
First,  <a href="https://en.wikipedia.org/wiki/Convention_over_configuration"><em>"convention  over  configuration"</em></a>, e.g. as  practiced  in  the Java build tool <a href="https://books.sonatype.com/mvnref-book/reference/installation-sect-conventionConfiguration.html">Maven</a>.
Second, <em>"DevOps"</em>, see <a href="https://en.wikipedia.org/wiki/DevOps">Wikipedia</a> or <a href="https://doi.org/10.1145/2723872.2723882">Boettiger</a>.</p>
<p>Another core goal is <em>simplicity</em>.
This specification should not re-do something which already exists (if it is an open specification or tool).
It must be possible to create a valid and working ERC manually.</p>
<p>The final important notion is the one of <em>nested containers</em>.
Acknowledging well defined standards exist for packaging a set of files, and different approaches to create an executable code package are possible, the collection of files which make up an ERC comprise <em>one or more containers but are themselves subject to being put into a container</em>.
We distinguish these containers into the inner or "runtime" container and the outer container.</p>
<h2 id="how-to-use-an-erc">How to use an ERC</h2>
<p>The steps to (re-)run the analysis contained in an ERC are as follows:</p>
<ul>
<li>(if compressed first extract then) open the ERC</li>
<li>execute the container</li>
<li>compare the output contained in the bag with the just created new output</li>
</ul>
<p>This way ERC allow computational reproducibility based on the original code and data.</p>
<h2 id="erc-structure">ERC structure</h2>
<h3 id="base-directory">Base directory</h3>
<p>An ERC MUST have a <em>base directory</em>. The name of the base directory MUST only contain characters, numbers, <code>_</code> (underscore) and <code>-</code> (minus sign).
That directory is part of the <a href="https://github.com/opencontainers/runtime-spec/blob/master/bundle.md">bundle</a>.
In other words, an archive of an ERC will have one top-level directory with the name of the base directory.</p>
<p><strong>Regular expression</strong> for base directory name: <code>[a-zA-Z0-9\-_]</code></p>
<p>The base directory MUST contain an <a href="#erc-configuration-file">ERC configuration file</a>.</p>
<p>Besides the files mentioned in this specification, the base directory may contain any other file and directories.</p>
<h2 id="erc-configuration-file">ERC configuration file</h2>
<p>The ERC configuration file is the <em>reproducibility manifest</em> for an ERC. It defines the main entry points for actions performed on an ERC and core metadata elements.</p>
<h3 id="name-format-and-encoding">Name, format, and encoding</h3>
<p>The filename MUST be <code>erc.yml</code> and it MUST be located in the base directory.
The contents MUST be valid <a href="http://yaml.org/">YAML 1.2</a>.
The file MUST be encoded in <code>UTF-8</code> and MUST NOT contain a byte-order mark (BOM).</p>
<h3 id="required-fields">Required fields</h3>
<p>The first document content of this file MUST contain the following string nodes at the root level.</p>
<ul>
<li><code>spec-version</code>: a text string noting the version of the used ERC specification. The appropriate version for an ERC conforming to this version of the specification is <code>1</code>.</li>
<li><code>id</code>: globally unique identifier for a specific ERC. This SHOULD be a URI (see <a href="https://tools.ietf.org/html/rfc3986">rfc3986</a>) or a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>, Version 4.</li>
</ul>
<p>Minimal example:</p>
<pre><code class="yml">id: b9b0099e-9f8d-4a33-8acf-cb0c062efaec
version: 1
</code></pre>

<h3 id="control-statements">Control statements</h3>
<p>The configuration file can contain <a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">bash</a> statements to control the runtime container.</p>
<p>These statements MUST be in an array under the node <code>command</code> under the root-level node <code>execution</code> in the ERC configuration file.</p>
<p>Default command statements of implementing tools MUST be as shown in the following example configuration file.</p>
<pre><code class="yml">id: b9b0099e-9f8d-4a33-8acf-cb0c062efaec
version: 1
execution:
  command:
    - `docker load --input image.tar`
    - `docker run -it -e TZ=CET erc:b9b0099e-9f8d-4a33-8acf-cb0c062efaec`
</code></pre>

<p>The exectution statements SHOULD ensure, that the re-computation is independent from the environment that may be different depending on the host.
This includes, for example, setting the time zone via an environment variable <code>-e TZ=CET</code> so that output formatting of timestamps does not break validation.
This can also be handled by the ERC author on script level.</p>
<h3 id="discovery-metadata">Discovery metadata</h3>
<p>author
title
description
. . .</p>
<p><em>The discovery metadata MUST be compliant to the o2r-metadata schema.</em></p>
<h3 id="license-metadata">License metadata</h3>
<p><code>erc.yml</code> MUST contain a first level node <code>licenses</code> with licensing information for the code, data, and text contained.
Each of these three have distinct requirements, hence different licenses need to be applied.</p>
<p>The node <code>licenses</code> MUST have three children: <code>code</code>, <code>data</code>, <code>text</code>.</p>
<div class="alert note" markdown="block">
There is currently no mechanism to define the licenses of the used libraries, as manual creation would be tedious.
Tools for automatic creation of ERC may add such detailed licensing information and define an extension to the ERC 
</div>

<p>The content of each of these child nodes MUST be one of the following</p>
<ul>
<li>text string with license identifier or license text. This SHOULD be a standardized identifier of an existing license as defined by the <a href="http://licenses.opendefinition.org/">Open Definition Licenses Service</a>.</li>
<li>a dictionary of all files or directories and their respective license, each of the values following the previous statement. The node values are the file paths relative to the base directory.</li>
</ul>
<p>Example for global licenses:</p>
<pre><code class="yml">id: b9b0099e-9f8d-4a33-8acf-cb0c062efaec
version: 1
licenses:
  code: &quot;Apache-2.0&quot;
  data: &quot;ODbL-1.0&quot;
  text: &quot;CC0-1.0&quot;
</code></pre>

<p>Example using specific licenses for files:</p>
<pre><code class="yml">---
id: b9b0099e-9f8d-4a33-8acf-cb0c062efaec
version: 1
licenses:
  code:
    Dockerfile: MIT
    my_code: GPL-3.0
  text:
    README.md: CC0-1.0
    paper/chapter01.doc: CC-BY-4.0
    paper/chapter02.tex: CC-BY-4.0
</code></pre>

<div class="alert note" markdown="block">
It IS NOT possible to assign one license to a directory and override that assignment or a single file within that directory, NOR IS it possible to use globs or regular expressions.
</div>

<h3 id="software-metadata">Software metadata</h3>
<p>An ERC SHOULD provide a machine readable list of software that is contained.
This list can have different formats for different use cases or depending on the source of information, which is probably a tool rather than manual creation.
The information can also be quite extensive.</p>
<p>Therefore this information MUST NOT be included in the ERC configuration file but SHOULD be referenced from there to support implementing tools.</p>
<p>The software metadata documents, if present, MUST be listed as paths relative to the base directory.</p>
<p>Information on the format of the files SHOULD be conveyed to both human and machine users based on file name and file extension.</p>
<p>Further details are unspecified here but could be defined in specification extensions.</p>
<pre><code class="yml">---
id: b9b0099e-9f8d-4a33-8acf-cb0c062efaec
version: 1
metadata:
  software:
    - .erc/software_codemeta.json
    - dpkg--list.txt
</code></pre>

<h3 id="extension-metadata">Extension metadata</h3>
<p>If an extension of the specification is used, it MUST be put into a list under the root-level node <code>extensions</code>.</p>
<pre><code class="yml">---
id: b9b0099e-9f8d-4a33-8acf-cb0c062efaec
version: 1
extensions:
  - extension_name_1
  - &quot;yet another extension&quot;
</code></pre>

<p>This list SHOULD be used by implementations that support these extensions to comply with validation checks or processes as defined by the extensions.</p>
<p>If an extension creates additional (custom) metadata fields, they MUST NOT interfere with the structure defined in this document.
However, it is unspecified into which root node or nodes of the ERC configuration file these metadata should go.</p>
<h2 id="runtime-container-file">Runtime container file</h2>
<p>The base directory MUST contain a <a href="https://en.wikipedia.org/wiki/Tar_(computing)">tarball</a> of a Docker image as created be the command <code>docker save</code>, see <a href="https://docs.docker.com/engine/reference/commandline/save/">Docker CLI save command documentation</a>.</p>
<p>The file SHOULD be named <code>image.tar</code>.</p>
<p>The output of the container during execution can be shown to the user to convey detailed information.</p>
<h2 id="runtime-container-manifest">Runtime container manifest</h2>
<p>The base directory MUST contain a valid Dockerfile, see <a href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference</a>.
The Dockerfile MUST contain the build instructions for the runtime environment and MUST have been used to create the image saved to the <a href="#runtime-container-file">runtime container file</a> using <code>docker build</code>, see <a href="https://docs.docker.com/engine/reference/commandline/build/">Docker CLI build command documentation</a>.
The build SHOULD be done with the option <code>--no-cache=true</code>.</p>
<p>The file SHOULD be named <code>Dockerfile</code>.</p>
<p>The Dockerfile MUST contain the required instruction <code>FROM</code>, which MUST NOT use the <code>latest</code> tag.</p>
<p>The Dockerfile SHOULD contain the instruction <code>MAINTAINER</code> to provide copyright information.</p>
<p>The Dockerfile MUST have an active instruction <code>CMD</code>, or a combination of the instructions <code>ENTRYPOINT</code> and <code>CMD</code>, which executes the packaged analysis.</p>
<p>The Dockerfile MUST NOT contain <code>EXPOSE</code> instructions.</p>
<p>The Dockerfile MUST contain a <code>VOLUME</code> instruction to define the mount point of the ERC within the container.
This mountpoint SHOULD be <code>/erc</code>.
If the mountpoint is different from <code>/erc</code>, the value MUST be defined in <code>erc.yml</code> in a node <code>execution.mountpoint</code>.</p>
<p>Example for the mountpoint configuration:</p>
<pre><code class="yml">---
id: b9b0099e-9f8d-4a33-8acf-cb0c062efaec
version: 1
execution:
  mountpoint: &quot;/erc&quot;
</code></pre>

<h3 id="metadata-in-container-manifest-under-development">Metadata in container manifest - <em>Under development</em></h3>
<p>... use <code>LABEL</code> and <code>ENV</code> installations?</p>
<h2 id="ercignore-file">.ercignore file</h2>
<p>The ERC MAY contain a file named <code>.ercignore</code> in the base directory.
If this file is present, any files and directories matching the patterns within that file will be excluded from processes such as validation.
The newline-separated patterns in the file will be treated as <a href="https://en.wikipedia.org/wiki/Glob_(programming)">Unix shell globs</a>.</p>
<h2 id="validation">Validation</h2>
<p>ERC validation comprises four steps:</p>
<ol>
<li>checking required metadata elements</li>
<li>executing the runtime container</li>
<li>comparing the results of the runtime container execution with the original files</li>
<li>running checks of used extensions</li>
</ol>
<p>The comparison step SHOULD be based on <code>md5</code> checksums and compare recursively all files that are <em>reasonable to hash as a comparison</em>.</p>
<p>The validation MUST NOT fail when files listed in <code>.ercignore</code> are failing comparison.</p>
<p>The following <a href="https://en.wikipedia.org/wiki/Media_type">media types</a> are a regular expressions of file formats that SHALL be used (unless ignored) for comparison:</p>
<ul>
<li><code>text/*</code></li>
<li><code>application/json</code></li>
<li><code>*+xml</code></li>
<li><code>*+json</code></li>
</ul>
<p>See <a href="https://www.iana.org/assignments/media-types/media-types.xhtml">IANA's full list of media types</a>.</p>
<h2 id="security-considerations">Security considerations</h2>
<p>Why are ERC not a security risk?</p>
<ul>
<li>the spec prohibits use of <code>EXPOSE</code></li>
<li>the containers are only executed <em>without</em> external network access using <code>Network: none</code>, see <a href="https://docs.docker.com/engine/reference/run/#/network-none">Docker CLI run documentation</a></li>
</ul>
<h2 id="secondary-metadata-files">Secondary metadata files</h2>
<p>An ERC can be an object in several use cases.
For example, it can be an item under review during a journal publication, it can be the actual publication at a workshop or conference, it can be a preserved item in a research repository.
All of these probably have their own standards and requirements when it comes to metadata.
These metadata requirements are <em>not</em> part of this specification, but the following conventions should simplify their (re-)use.</p>
<p>Domain or use case specific metadata SHOULD replicate all and only the information required for the specific case.</p>
<p>Metadata documents of specific use cases SHOULD be stored in a directory <code>.erc</code> in the base directory.</p>
<p>They SHOULD be named according to the used standard or platform, and the used format, e.g. <code>datacite.xml</code> or <code>zenodo_sandbox.json</code>.</p>
<h2 id="comprehensive-example-of-ercyml">Comprehensive example of erc.yml</h2>
<p>The following example shows all possible fields and their default values of the core specification.</p>
<pre><code class="yml">id: b9b0099e-9f8d-4a33-8acf-cb0c062efaec
version: 1
structure:
  payload_directory: &quot;data&quot;
  config_file: &quot;erc.yml&quot;
  container_file: &quot;image.tar&quot;
  container_manifest: &quot;Dockerfile&quot;
execution:
  mountpoint: &quot;/erc&quot;
  command: &quot;rmarkdown::render(input = 'paper.Rmd', output_format = )&quot;
licenses:
  ...
</code></pre></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '..';
    </script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
    <script src="../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
